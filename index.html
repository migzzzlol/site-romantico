<!doctype html>
<html lang="pt">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Para a Minha Namorada ‚ù§Ô∏è</title>
<style>
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui, -apple-system,'Segoe UI',Roboto,Arial;color:#233}
  body{background:linear-gradient(180deg,#f8fbff 0%,#f0f7ff 50%,#fce4ec 100%);-webkit-font-smoothing:antialiased;overflow-x:hidden}
  header{padding:28px 16px;text-align:center}
  header h1{margin:0;font-size:2rem;color:#0b3f6b}
  .mensagem{background:white;padding:22px;border-radius:14px;box-shadow:0 6px 18px rgba(12,40,70,0.06);font-size:1.05rem}
  .gallery-wrap{max-width:1000px;margin:24px auto;padding:18px}
  .slides{display:flex;transition:transform .5s ease;overflow:hidden;border-radius:12px}
  .slides img{width:100%;height:420px;object-fit:cover;flex-shrink:0}
  .thumbs{display:flex;gap:8px;margin-top:12px;overflow-x:auto}
  .thumbs img{width:120px;height:80px;object-fit:cover;border-radius:8px;cursor:pointer;opacity:.9;border:3px solid transparent}
  .thumbs img.active{border-color:#9fd4ff}
  .editor-btn{position:fixed;right:18px;bottom:18px;z-index:1000}
  .editor-panel{position:fixed;right:18px;bottom:72px;width:360px;max-width:94%;background:white;padding:12px;border-radius:12px;box-shadow:0 12px 40px rgba(2,18,45,0.12);z-index:1000;display:none}
  .btn{background:rgba(255,255,255,0.95);border:none;padding:10px;border-radius:10px;cursor:pointer}
  .hearts{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:1}
  .heart{position:absolute;top:-10%;font-size:24px;color:#bfe8ff;animation:fall linear infinite;opacity:.9}
  @keyframes fall{0%{transform:translateY(-10vh)}100%{transform:translateY(120vh)}}
  .login-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg, rgba(3,39,78,0.28), rgba(241,182,214,0.12));z-index:999}
  .login-card{width:320px;background:rgba(255,255,255,0.98);padding:22px;border-radius:14px;box-shadow:0 12px 40px rgba(2,18,45,0.15);text-align:center}
  footer{text-align:center;margin:28px auto 80px;color:#5a6b78}
  .note{font-size:0.85rem;color:#6b7d8b}
  @media(max-width:700px){.slides img{height:260px}.thumbs img{width:88px;height:64px}.login-card{width:92%}}
</style>
</head>
<body>
  <div class="hearts" id="hearts"></div>

  <div class="login-overlay" id="login">
    <div class="login-card">
      <h2>Bem-vinda üíó</h2>
      <p>Insere a nossa senha para ver as surpresas</p>
      <input id="pin" type="password" placeholder="******" aria-label="senha" style="width:100%;padding:10px;border-radius:8px;border:1px solid #e6e9ef" />
      <div style="height:10px"></div>
      <div id="loginError" style="min-height:18px;color:#b43;font-size:0.95rem"></div>
      <div style="height:8px"></div>
      <button id="btnEnter" class="btn" style="width:100%;">Entrar</button>
      <p style="font-size:0.85rem;color:#8aa0b4;margin-top:10px">Prometo que s√£o s√≥ coisas bonitas üíå</p>
    </div>
  </div>

  <header>
    <h1 id="siteTitle">Para Ti, Meu Amor</h1>
    <p id="siteSubtitle">Um cantinho privado com as nossas mem√≥rias</p>
  </header>

  <main id="conteudo" style="opacity:0;transform:translateY(6px);transition:all .4s ease;">
    <section class="mensagem" contenteditable="true" id="mensagem">
      <h2>Mensagem</h2>
      <p>Escreve aqui algo doce ‚Äî √© edit√°vel diretamente. Guarda o ficheiro depois de editar para manter as altera√ß√µes.</p>
    </section>

    <section class="gallery-wrap">
      <h3 style="margin-top:18px">A Nossa Galeria üì∏</h3>
      <div style="position:relative">
        <div class="slides" id="slides"></div>
        <div style="position:absolute;left:12px;top:50%;transform:translateY(-50%)">
          <button id="prev" class="btn">‚óÄ</button>
        </div>
        <div style="position:absolute;right:12px;top:50%;transform:translateY(-50%)">
          <button id="next" class="btn">‚ñ∂</button>
        </div>
      </div>
      <div class="thumbs" id="thumbs"></div>
      <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
        <div class="contador">Dias juntos: <strong id="dias">0</strong></div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button id="autoplay" class="btn">Auto-play</button>
          <button id="openSecret" class="btn">Mensagens</button>
        </div>
      </div>
    </section>
  </main>

  <section id="timelineWrap" style="max-width:1000px;margin:18px auto;padding:18px;display:none">
    <h3>Linha do Tempo üóìÔ∏è</h3>
    <div id="timelineList" style="display:flex;flex-direction:column;gap:12px"></div>
  </section>

  <div id="secretModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,10,30,0.5);z-index:1200">
    <div style="background:white;padding:18px;border-radius:12px;max-width:420px;width:94%">
      <h3>Mensagens Secretas üîí</h3>
      <p>Insere o c√≥digo para revelar mensagens:</p>
      <input id="secretInput" type="password" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd" />
      <div style="display:flex;gap:8px;margin-top:10px">
        <button id="checkSecret" class="btn">Verificar</button>
        <button id="closeSecret" class="btn">Fechar</button>
      </div>
      <div id="secretResult" style="margin-top:12px"></div>
    </div>
  </div>

  <div class="editor-btn">
    <button id="openEditorBtn" class="btn">‚úé Editar</button>
  </div>

  <div class="editor-panel" id="editor">
    <h3>Editor r√°pido</h3>
    <label>T√≠tulo do site</label>
    <input type="text" id="inputTitle" />
    <label>Subt√≠tulo</label>
    <input type="text" id="inputSubtitle" />
    <label>Mensagem (texto)</label>
    <textarea id="inputMessage"></textarea>
    <label>Adicionar fotos (v√°rias)</label>
    <input type="file" id="inputImgs" accept="image/*" multiple />
    <label>M√∫sica (opcional)</label>
    <input type="file" id="inputMusic" accept="audio/*" />
    <div style="display:flex;gap:8px;margin-top:8px">
      <button id="apply" class="btn">Aplicar</button>
      <button id="saveLocal" class="btn">Guardar local</button>
      <button id="exportHTML" class="btn">Exportar HTML</button>
    </div>
    <hr/>
    <h4>Linha do Tempo</h4>
    <input type="date" id="tDate"/><input type="text" id="tTitle" placeholder="T√≠tulo" style="width:100%;margin-top:6px"/>
    <textarea id="tDesc" placeholder="Descri√ß√£o..." style="width:100%;margin-top:6px"></textarea>
    <button id="addT" class="btn" style="margin-top:6px">Adicionar evento</button>
    <hr/>
    <h4>Mensagem Secreta</h4>
    <input type="text" id="sCode" placeholder="C√≥digo" style="width:100%;margin-top:6px"/>
    <input type="text" id="sTitle" placeholder="T√≠tulo" style="width:100%;margin-top:6px"/>
    <textarea id="sText" placeholder="Texto..." style="width:100%;margin-top:6px"></textarea>
    <button id="addS" class="btn" style="margin-top:6px">Adicionar mensagem secreta</button>
    <p class="note">As altera√ß√µes guardadas ficam no browser (localStorage). Usa Exportar para gerar um ficheiro standalone.</p>
  </div>

  <footer><small>Feito com carinho üíô</small></footer>

<script>
function qs(id){return document.getElementById(id)}
const STORAGE_KEY = 'siteRomantico_v_final';

/* login */
(function(){
  const correta = '1112025';
  const pin = qs('pin'), btn = qs('btnEnter'), overlay = qs('login'), err = qs('loginError');
  if(!pin || !btn || !overlay) return;
  try{ pin.focus(); }catch(e){}
  function attempt(){
    const v = (pin.value||'').trim();
    if(v === correta){
      overlay.style.transition='opacity .6s ease';
      overlay.style.opacity='0';
      setTimeout(()=>{ overlay.style.display='none'; qs('conteudo').style.opacity='1'; qs('conteudo').style.transform='translateY(0)'; alert('Bem-vinda, meu amor ‚ù§Ô∏è'); },600);
    } else {
      if(err) err.textContent = 'Senha incorreta ‚Äî tenta novamente.';
      pin.focus(); pin.select();
    }
  }
  btn.addEventListener('click', attempt);
  pin.addEventListener('keydown', function(e){ if(e.key==='Enter') attempt(); });
})();

/* hearts */
(function(){
  const c = qs('hearts');
  for(let i=0;i<20;i++){
    const d = document.createElement('div');
    d.className='heart';
    d.textContent='üíô';
    d.style.left = Math.random()*100 + 'vw';
    d.style.fontSize = (12 + Math.random()*30) + 'px';
    d.style.animationDuration = (4 + Math.random()*6) + 's';
    c.appendChild(d);
  }
})();

/* config */
function loadConfig(){ try{ const raw = localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw): {title:'Para Ti, Meu Amor', subtitle:'Um cantinho privado com as nossas mem√≥rias', message:'<h2>Mensagem</h2><p>Escreve aqui algo doce.</p>', images:[], music:'', timeline:[], secrets:[]}; }catch(e){ return {title:'Para Ti,Meu Amor', subtitle:'Um cantinho privado', message:'<h2>Mensagem</h2><p>Escreve aqui algo doce.</p>', images:[], music:'', timeline:[], secrets:[]}; } }
function saveConfig(cfg){ localStorage.setItem(STORAGE_KEY, JSON.stringify(cfg)); }

/* gallery */
let index = 0;
function renderGallery(images){
  const slides = qs('slides'), thumbs = qs('thumbs');
  slides.innerHTML=''; thumbs.innerHTML='';
  images.forEach((src,i)=>{
    const img = document.createElement('img'); img.src = src; img.alt = 'foto '+(i+1);
    slides.appendChild(img);
    const t = document.createElement('img'); t.src=src; t.dataset.index=i;
    t.addEventListener('click', ()=>{ index = i; update(); });
    thumbs.appendChild(t);
  });
  index = 0; update();
}
function update(){
  const slides = qs('slides'); const total = slides.children.length;
  if(!total) return;
  slides.style.transform = 'translateX(' + (-index*100) + '%)';
  Array.from(qs('thumbs').children).forEach((t,i)=> t.classList.toggle('active', i===index));
}

/* timeline */
function renderTimeline(items){
  const wrap = qs('timelineWrap'), list = qs('timelineList');
  list.innerHTML='';
  if(!items || !items.length){ wrap.style.display='none'; return; }
  wrap.style.display='block';
  items.sort((a,b)=> new Date(a.date) - new Date(b.date));
  items.forEach(it=>{
    const el = document.createElement('div');
    el.style.padding='10px'; el.style.borderRadius='8px'; el.style.background='#fff'; el.style.boxShadow='0 6px 18px rgba(12,40,70,0.04)';
    el.innerHTML = '<strong>'+escapeHtml(it.title)+'</strong> <span style="float:right;color:#6b7d8b">'+escapeHtml(it.date)+'</span><div style="clear:both;margin-top:6px">'+escapeHtml(it.desc)+'</div>';
    list.appendChild(el);
  });
}

/* secrets */
function openSecretModal(){ qs('secretModal').style.display='flex'; qs('secretInput').value=''; qs('secretResult').innerHTML=''; }
function closeSecretModal(){ qs('secretModal').style.display='none'; }
qs('openSecret').addEventListener('click', openSecretModal);
qs('closeSecret').addEventListener('click', closeSecretModal);
qs('checkSecret').addEventListener('click', ()=>{
  const code = (qs('secretInput').value||'').trim();
  const cfg = loadConfig();
  const found = (cfg.secrets||[]).filter(s=>s.code === code);
  const res = qs('secretResult');
  if(!found.length){ res.innerHTML = '<div style="color:#b43">C√≥digo n√£o encontrado.</div>'; return; }
  res.innerHTML = '';
  found.forEach(s=>{
    const box = document.createElement('div');
    box.style.padding='10px'; box.style.borderRadius='8px'; box.style.background='#f7fafe'; box.style.marginTop='8px';
    box.innerHTML = '<strong>'+escapeHtml(s.title)+'</strong><div style="margin-top:6px">'+escapeHtml(s.text)+'</div>';
    res.appendChild(box);
  });
});

/* editor wiring */
qs('openEditorBtn').addEventListener('click', ()=>{
  const ed = qs('editor'); ed.style.display = ed.style.display === 'none' ? 'block' : 'none';
  loadConfigToUI();
});
function loadConfigToUI(){
  const cfg = loadConfig();
  qs('inputTitle').value = cfg.title || '';
  qs('inputSubtitle').value = cfg.subtitle || '';
  qs('inputMessage').value = (cfg.message||'').replace(/<[^>]+>/g,'').trim();
}

/* uploads */
qs('inputImgs').addEventListener('change', function(){
  const files = Array.from(this.files); if(!files.length) return;
  const cfg = loadConfig();
  const promises = files.map(f=>new Promise((res,rej)=>{ const r = new FileReader(); r.onload = ()=>res(r.result); r.onerror = rej; r.readAsDataURL(f); }));
  Promise.all(promises).then(urls=>{
    cfg.images = (cfg.images||[]).concat(urls); saveConfig(cfg); applyConfig(cfg); alert('Imagens adicionadas.'); qs('inputImgs').value='';
  }).catch(()=>alert('Erro a ler imagens.'));
});
qs('inputMusic').addEventListener('change', function(){
  const f = this.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ()=>{ const cfg = loadConfig(); cfg.music = r.result; saveConfig(cfg); applyConfig(cfg); alert('M√∫sica guardada.'); qs('inputMusic').value=''; }; r.readAsDataURL(f);
});

/* apply/save/export */
qs('apply').addEventListener('click', ()=>{
  const cfg = loadConfig();
  cfg.title = qs('inputTitle').value || cfg.title;
  cfg.subtitle = qs('inputSubtitle').value || cfg.subtitle;
  cfg.message = '<h2>Mensagem</h2><p>' + (qs('inputMessage').value||'').replace(/\n/g,'<br>') + '</p>';
  saveConfig(cfg); applyConfig(cfg); alert('Altera√ß√µes aplicadas.');
});
qs('saveLocal').addEventListener('click', ()=>{ saveConfig(loadConfig()); alert('Guardado no navegador.'); });
qs('exportHTML').addEventListener('click', ()=>{
  const cfg = loadConfig();
  const html = generateStandalone(cfg);
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'site_romantico_export.html'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});

/* timeline add/secret add */
qs('addT').addEventListener('click', ()=>{
  const date = qs('tDate').value, title = qs('tTitle').value, desc = qs('tDesc').value;
  if(!date || !title) return alert('Data e t√≠tulo obrigat√≥rios.');
  const cfg = loadConfig(); cfg.timeline = cfg.timeline || []; cfg.timeline.push({date:title?date:'', title:title, desc:desc||''}); saveConfig(cfg); applyConfig(cfg); qs('tDate').value=''; qs('tTitle').value=''; qs('tDesc').value=''; alert('Evento adicionado.');
});
qs('addS').addEventListener('click', ()=>{
  const code = (qs('sCode').value||'').trim(), title = qs('sTitle').value, text = qs('sText').value;
  if(!code || !title) return alert('C√≥digo e t√≠tulo obrigat√≥rios.');
  const cfg = loadConfig(); cfg.secrets = cfg.secrets||[]; cfg.secrets.push({code, title, text}); saveConfig(cfg); applyConfig(cfg); qs('sCode').value=''; qs('sTitle').value=''; qs('sText').value=''; alert('Mensagem secreta adicionada.');
});

/* slideshow controls */
qs('next').addEventListener('click', ()=>{ const s = qs('slides'); if(!s.children.length) return; index = (index+1)%s.children.length; update(); });
qs('prev').addEventListener('click', ()=>{ const s = qs('slides'); if(!s.children.length) return; index = (index-1+s.children.length)%s.children.length; update(); });
let playInt = null;
qs('autoplay').addEventListener('click', function(){
  if(playInt){ clearInterval(playInt); playInt=null; this.textContent='Auto-play'; }
  else { playInt = setInterval(()=>{ const s = qs('slides'); if(!s.children.length) return; index=(index+1)%s.children.length; update(); },3000); this.textContent='Parar'; }
});

/* applyConfig (defined before use) */
function applyConfig(cfg){
  cfg = cfg || loadConfig();
  qs('siteTitle').textContent = cfg.title || '';
  qs('siteSubtitle').textContent = cfg.subtitle || '';
  qs('mensagem').innerHTML = cfg.message || '';
  renderGallery(cfg.images || []);
  if(cfg.music){ try{ let a = qs('bgMusic'); if(!a) { a = document.createElement('audio'); a.id='bgMusic'; a.loop=true; document.body.appendChild(a);} a.src = cfg.music; }catch(e){} }
  renderTimeline(cfg.timeline || []);
}

/* init */
(function init(){
  const cfg = loadConfig(); applyConfig(cfg);
})();

function generateStandalone(cfg){
  cfg = cfg || loadConfig();
  function esc(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
  const imgs = (cfg.images||[]).map(s=>'<img src="'+s.replace(/"/g,'\"')+'" />').join('\n');
  const musicTag = cfg.music? '<audio id="bgMusic" loop src="'+cfg.music+'"></audio>':'';
  return '<!doctype html><html lang="pt"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>'+esc(cfg.title)+'</title></head><body>'+musicTag+'<h1>'+esc(cfg.title)+'</h1><div>'+imgs+'</div></body></html>';
}

function escapeHtml(s){ return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
</script>
</body>
</html>
